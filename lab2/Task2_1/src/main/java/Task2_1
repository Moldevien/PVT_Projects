
--create database Cafe

-- Клієнти
create table clients (
    id serial primary key,
    first_name varchar(30) not null,
    last_name varchar(30) not null,
    birth_date date,
    phone varchar(13),
    mail varchar(100) not null,
    discount numeric(4,2) default 0 check (discount between 0 and 100)
);

-- Тип продукту
create table product_types (
    id serial primary key,
    name varchar(30) not null
);

-- Товар
create table products (
    id serial primary key,
    name_ua varchar(100) not null,
    name_en varchar(100) not null,
    price numeric(6,2) not null,
    type_id int references product_types(id) on delete set null
);

-- Позиція
create table positions (
    id serial primary key,
    name varchar(30) not null
);

-- Персонал
create table staff (
    id serial primary key,
    first_name varchar(30) not null,
    last_name varchar(30) not null,
    phone varchar(13) not null,
    mail varchar(100) not null,
    position_id int references positions(id) on delete set null
);

-- Графік роботи
create table staff_schedule (
    id serial primary key,
    staff_id int references staff(id) on delete set null,
    work_date date not null
);

-- Замовлення
create table orders (
    id serial primary key,
    client_id int references clients(id) on delete set null,
    staff_id int references staff(id) on delete set null,
    order_date timestamp default current_timestamp
);

-- Товар-замовлення
create table order_products (
    id serial primary key,
    order_id int references orders(id) on delete cascade,
    product_id int references products(id) on delete set null,
    quantity int default 1 check (quantity > 0)
);

-- Додамо позиції
insert into positions (name)
values ('Бариста'), ('Офіціант'), ('Кондитер');

-- Додамо тийпи продуктів
insert into product_types (name)
values ('Десерт'), ('Напій');

-- Додамо працівників
insert into staff (first_name, last_name, phone, mail, position_id)
values
('Іван', 'Бариста', '+380971111111', 'Ivan@gmail.com', 1),
('Марія', 'Офіціант', '+380972222222', 'Maria@gmail.com', 2),
('Олег', 'Кондитер', '+380973333333', 'Oleg@gmail.com', 3);

-- Додамо клієнтів
insert into clients (first_name, last_name, birth_date, phone, mail, discount)
values
('Анна', 'Петрова', '1995-03-10', '+380501111111', 'Petrov@gmail.com', 5),
('Олександр', 'Коваль', '1988-07-22', '+380502222222', 'Olexa@gmail.com', 10);

-- Додамо продукти
insert into products (name_ua, name_en, price, type_id)
values
('Еспресо', 'Espresso', 45.00, 2),
('Капучино', 'Cappuccino', 60.00, 2),
('Чізкейк', 'Cheesecake', 85.00, 1),
('Тірамісу', 'Tiramisu', 95.00, 1);

-- Додамо розклад роботи
insert into staff_schedule (staff_id, work_date)
values
(1, '2025-10-06'),
(2, '2025-10-06'),
(3, '2025-10-06');

-- Додамо замовлення
insert into orders (client_id, staff_id)
values
(1, 2),
(2, 1);

-- Додамо товари в замовлення
insert into order_products (order_id, product_id, quantity)
values
(1, 2, 2),
(1, 3, 1),
(2, 2, 1),
(2, 4, 1);